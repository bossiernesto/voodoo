package org.uqbar.voodoo.exhaustive

import org.scalatest.FreeSpec
import org.scalatest.Matchers
import org.scalatest.prop.TableDrivenPropertyChecks

class ExhaustiveMaxStackTest extends FreeSpec with TableDrivenPropertyChecks with Matchers {

	val maxStacks = Table(("Instruction", "MaxStack"), ("AALOAD", 2),
		("AASTORE", 3),
		("ACONST_NULL", 1),
		("ALOAD", 1),
		("ALOAD_0", 1),
		("ALOAD_1", 1),
		("ALOAD_2", 1),
		("ALOAD_3", 1),
		("ANEWARRAY", 1),
		("ARETURN", 1),
		("ARRAYLENGTH", 1),
		("ASTORE", 1),
		("ASTORE_0", 1),
		("ASTORE_1", 1),
		("ASTORE_2", 1),
		("ASTORE_3", 1),
		("ATHROW", 2),
		("BALOAD", 2),
		("BASTORE", 3),
		("BIPUSH", 1),
		("CALOAD", 2),
		("CASTORE", 3),
		("CHECKCAST", 1),
		("D2F", 2),
		("D2I", 2),
		("D2L", 2),
		("DADD", 4),
		("DALOAD", 2),
		("DASTORE", 4),
		("DCMPG", 4),
		("DCMPL", 4),
		("DCONST_0", 2),
		("DCONST_1", 2),
		("DDIV", 4),
		("DLOAD", 2),
		("DLOAD_0", 2),
		("DLOAD_1", 2),
		("DLOAD_2", 2),
		("DLOAD_3", 2),
		("DMUL", 4),
		("DNEG", 2),
		("DREM", 4),
		("DRETURN", 2),
		("DSTORE", 2),
		("DSTORE_0", 2),
		("DSTORE_1", 2),
		("DSTORE_2", 2),
		("DSTORE_3", 2),
		("DSUB", 4),
		("DUP", 2),
		("DUP_X1", 3),
		("DUP_X2", 4),
		("DUP2", 4),
		("DUP2_X1", 6),
		("DUP2_X2", 6),
		("F2D", 2),
		("F2I", 1),
		("F2L", 2),
		("FADD", 2),
		("FALOAD", 2),
		("FASTORE", 3),
		("FCMPG", 2),
		("FCMPL", 2),
		("FCONST_0", 1),
		("FCONST_1", 1),
		("FCONST_2", 1),
		("FDIV", 2),
		("FLOAD", 1),
		("FLOAD_0", 1),
		("FLOAD_1", 1),
		("FLOAD_2", 1),
		("FLOAD_3", 1),
		("FMUL", 2),
		("FNEG", 1),
		("FREM", 2),
		("FRETURN", 1),
		("FSTORE", 1),
		("FSTORE_0", 1),
		("FSTORE_1", 1),
		("FSTORE_2", 1),
		("FSTORE_3", 1),
		("FSUB", 2),
		("GETFIELD", 1),
		("GETSTATIC", 1),
		("GOTO", 2),
		("GOTO_W", 2),
		("I2B", 1),
		("I2C", 1),
		("I2D", 2),
		("I2F", 1),
		("I2L", 2),
		("I2S", 1),
		("IADD", 2),
		("IALOAD", 2),
		("IAND", 2),
		("IASTORE", 3),
		("ICONST_M1", 1),
		("ICONST_0", 1),
		("ICONST_1", 1),
		("ICONST_2", 1),
		("ICONST_3", 1),
		("ICONST_4", 1),
		("ICONST_5", 1),
		("IDIV", 2),
		("IF_ACMPEQ", 2),
		("IF_ACMPNE", 2),
		("IF_ICMPEQ", 2),
		("IF_ICMPNE", 2),
		("IF_ICMPLT", 2),
		("IF_ICMPGE", 2),
		("IF_ICMPGT", 2),
		("IF_ICMPLE", 2),
		("IFEQ", 1),
		("IFNE", 1),
		("IFLT", 1),
		("IFGE", 1),
		("IFGT", 1),
		("IFLE", 1),
		("IFNONNULL", 1),
		("IFNULL", 1),
		("IINC", 1),
		("ILOAD", 1),
		("ILOAD_0", 1),
		("ILOAD_1", 1),
		("ILOAD_2", 1),
		("ILOAD_3", 1),
		("IMUL", 2),
		("INEG", 1),
		("INSTANCEOF", 1),
		("INVOKEDYNAMIC", 2),
		("INVOKEINTERFACE", 2),
		("INVOKESPECIAL", 2),
		("INVOKESTATIC", 1),
		("INVOKEVIRTUAL", 1),
		("IOR", 2),
		("IREM", 2),
		("IRETURN", 1),
		("ISHL", 2),
		("ISHR", 2),
		("ISTORE", 1),
		("ISTORE_0", 1),
		("ISTORE_1", 1),
		("ISTORE_2", 1),
		("ISTORE_3", 1),
		("ISUB", 2),
		("IUSHR", 2),
		("IXOR", 2),
		("JSR", 2),
		("JSR_W", 2),
		("L2D", 2),
		("L2F", 2),
		("L2I", 2),
		("LADD", 4),
		("LALOAD", 2),
		("LAND", 4),
		("LASTORE", 4),
		("LCMP", 4),
		("LCONST_0", 2),
		("LCONST_1", 2),
		("LDC", 3),
		("LDC2_W", 4),
		("LDIV", 4),
		("LLOAD", 2),
		("LLOAD_0", 2),
		("LLOAD_1", 2),
		("LLOAD_2", 2),
		("LLOAD_3", 2),
		("LMUL", 4),
		("LNEG", 2),
		("LOOKUPSWITCH", 2),
		("LOR", 4),
		("LREM", 4),
		("LRETURN", 2),
		("LSHL", 3),
		("LSHR", 3),
		("LSTORE", 2),
		("LSTORE_0", 2),
		("LSTORE_1", 2),
		("LSTORE_2", 2),
		("LSTORE_3", 2),
		("LSUB", 4),
		("LUSHR", 3),
		("LXOR", 4),
		("MONITORENTER", 4),
		("MONITOREXIT", 4),
		("MULTIANEWARRAY", 1),
		("NEW", 2),
		("NEWARRAY", 1),
		("NOP", 0),
		("POP", 2),
		("POP2", 4),
		("PUTFIELD", 2),
		("PUTSTATIC", 1),
		("RET", 2),
		("RETURN", 0),
		("SALOAD", 2),
		("SASTORE", 3),
		("SIPUSH", 1),
		("SWAP", 2),
		("TABLESWITCH", 2),
		("WIDE", 1)
	)

	"MaxStack should be as expected" in {
		forAll(maxStacks){ (instruction, maxStack) =>
			BytecodeExample.of(instruction).code.maxStack should be(maxStack)
		}
	}
}